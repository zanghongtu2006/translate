




<!DOCTYPE html><html lang="en"
      class="chekov"><head><script>var a=window.devsite||{};window.devsite=a;a.readyCallbacks=[];window.devsite.readyCallbacks=a.readyCallbacks;a.ready=function(b){a.readyCallbacks.push(b)};window.devsite.ready=a.ready;
</script><meta charset="utf-8"><meta name="xsrf_token" content="U6D-_ZsMF7fK7YTjAEFPmK6vhppcmG86SQEcoUJAckg6MTUxNzg2MDI3NjQ3NjY5MA" /><link rel="canonical" href="https://www.tensorflow.org/serving/serving_basic"><link rel="alternate" href="https://www.tensorflow.org/serving/serving_basic" hreflang="en"><link rel="alternate" href="serving_basic" hreflang="en-cn"><link rel="alternate" href="https://www.tensorflow.org/serving/serving_basic" hreflang="x-default"><link rel="shortcut icon" href="../_static/18908e5f48/images/tensorflow/favicon.png"><link rel="apple-touch-icon" href="../images/apple-touch-icon-180x180.png"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Roboto:300,400,400italic,500,500italic,700,700italic|Roboto+Mono:400,500,700|Material+Icons"><link rel="stylesheet"
        href="../_static/18908e5f48/css/devsite-tensorflow-orange.css"><script src="../_static/18908e5f48/js/jquery-bundle.js"></script><meta property="og:site_name" content="TensorFlow"><meta property="og:type" content="website"><meta property="og:url" content="https://www.tensorflow.org/serving/serving_basic"><meta property="og:locale" content="en"><script>
    var ___gcfg = ___gcfg || {};
    ___gcfg.lang = 'zh-cn';
  </script><title>Serving a TensorFlow Model &nbsp;|&nbsp; TensorFlow</title><meta property="og:title" content="Serving a TensorFlow Model &nbsp;|&nbsp; TensorFlow"></head><body class="
               devsite-doc-page
               
               
               
               
               devsite-header-no-lower-tabs"
        id="top_of_page"><div class="devsite-wrapper"><div class="devsite-top-section-wrapper
            "><header class="devsite-top-section nocontent"><div class="devsite-top-logo-row-wrapper-wrapper"><div class="devsite-top-logo-row-wrapper"><div class="devsite-top-logo-row devsite-full-site-width"><button type="button" class="devsite-expand-section-nav devsite-header-icon-button
                                       button-flat material-icons gc-analytics-event"
                  data-category="Site-Wide Custom Events" data-label="Hamburger menu"></button><div class="devsite-product-name-wrapper"><a href="../index.html" class="devsite-site-logo-link gc-analytics-event"
   data-category="Site-Wide Custom Events" data-label="Site logo"><img src="../_static/18908e5f48/images/tensorflow/lockup.png"
       class="devsite-site-logo" alt="TensorFlow"><span class="devsite-site-name devsite-product-name">TensorFlow</span></a></div><div class="devsite-header-upper-tabs"><nav class="devsite-doc-set-nav devsite-nav devsite-overflow-tabs-scroll-wrapper"><ul class="devsite-doc-set-nav-tab-list devsite-overflow-tabs-scroll"><li class="devsite-doc-set-nav-tab-container"><a href="../install/index"
         class="
                devsite-doc-set-nav-tab gc-analytics-event"
       
         data-category="Site-Wide Custom Events"
       
         data-label="Tab: Install"
       >
        Install
      </a></li><li class="devsite-doc-set-nav-tab-container"><a href="../get_started/index"
         class="
                devsite-doc-set-nav-tab gc-analytics-event"
       
         data-category="Site-Wide Custom Events"
       
         data-label="Tab: Develop"
       >
        Develop
      </a></li><li class="devsite-doc-set-nav-tab-container"><a href="../api_docs.1"
         class="
                devsite-doc-set-nav-tab gc-analytics-event"
       
         data-category="Site-Wide Custom Events"
       
         data-label="Tab: API r1.5"
       >
        API r1.5
      </a></li><li class="devsite-doc-set-nav-tab-container"><a href="../deploy/index"
         class="devsite-doc-set-nav-active
                devsite-doc-set-nav-tab gc-analytics-event"
       
         data-category="Site-Wide Custom Events"
       
         data-label="Tab: Deploy"
       >
        Deploy
      </a></li><li class="devsite-doc-set-nav-tab-container"><a href="../extend/index.html"
         class="
                devsite-doc-set-nav-tab gc-analytics-event"
       
         data-category="Site-Wide Custom Events"
       
         data-label="Tab: Extend"
       >
        Extend
      </a></li><li class="devsite-doc-set-nav-tab-container"><a href="../community/index.html"
         class="
                devsite-doc-set-nav-tab gc-analytics-event"
       
         data-category="Site-Wide Custom Events"
       
         data-label="Tab: Community"
       >
        Community
      </a></li><li class="devsite-doc-set-nav-tab-container"><a href="../versions/index.html"
         class="
                devsite-doc-set-nav-tab gc-analytics-event"
       
         data-category="Site-Wide Custom Events"
       
         data-label="Tab: Versions"
       >
        Versions
      </a></li><li class="devsite-doc-set-nav-tab-container"><a href="../tfrc/index.html"
         class="
                devsite-doc-set-nav-tab gc-analytics-event"
       
         data-category="Site-Wide Custom Events"
       
         data-label="Tab: TFRC"
       >
        TFRC
      </a></li></ul></nav></div><form class="devsite-search-form"
                action="https://tensorflow.google.cn/s/results/"
                method="GET"
                id="top-search"
                search-placeholder='搜索'><div id="searchbox" class="devsite-searchbox"><input placeholder='搜索'
         
         type="text"
         class="devsite-search-field devsite-search-query"
         name="q"
         value=""
         autocomplete="off"><div class="devsite-search-image material-icons"></div></div><input type="hidden"
       name="p"
       id="search_project"
       value="/"
       data-project-name="TensorFlow"
       data-project-path="/"
       data-query-match=""><input type="hidden" class="suggest-project" value="TensorFlow" /><div class="suggest-project-metadata" data-home_url="/" data-path="/" data-name="Android Developers" ></div><div class="suggest-project-metadata" data-home_url="/" data-path="/" data-name="Android Open Source Project" ></div><div class="suggest-project-metadata" data-home_url="/" data-path="/" data-name="Google Cloud Platform" ></div><div class="suggest-project-metadata" data-home_url="/" data-path="/" data-name="Dialogflow" ></div><div class="suggest-project-metadata" data-home_url="/" data-path="/" data-name="Firebase" ></div><div class="suggest-project-metadata" data-home_url="/" data-path="/" data-name="Link.app" ></div><div class="suggest-project-metadata" data-home_url="/" data-path="/" data-name="Nest Developers" ></div><div class="suggest-project-metadata" data-home_url="/" data-path="/" data-name="OpenThread" ></div><div class="suggest-project-metadata" data-home_url="/" data-path="/" data-name="TensorFlow" ></div></form><button type="button" class="devsite-search-button devsite-header-icon-button button-flat
                                       material-icons"></button></div></div></div><div class="devsite-collapsible-section"><div class="devsite-header-background devsite-full-site-width"><div class="devsite-product-id-row devsite-full-site-width"><div class="devsite-product-description-row"><ul class="devsite-breadcrumb-list"><li class="devsite-breadcrumb-item">
    
    
    
      Deploy
    
    
  </li></ul></div></div></div></div></header><script>
    if (window.jQuery) {
      $(document).ready(function() {
        if (window.devsite && window.devsite.search) {
          
          window.devsite.search.init('zh-cn')
        }
      });
    }
  </script></div><div id="gc-wrapper"itemscope itemtype="http://schema.org/Article"><input class="google-analytics-id-json" type="hidden" value="{&quot;dimensions&quot;: {&quot;dimension6&quot;: &quot;en&quot;, &quot;dimension4&quot;: &quot;TensorFlow&quot;, &quot;dimension5&quot;: &quot;zh-cn&quot;, &quot;dimension3&quot;: false, &quot;dimension1&quot;: &quot;Signed out&quot;, &quot;dimension8&quot;: null}, &quot;gaid&quot;: &quot;UA-69864048-6&quot;}"><script>
      var dataLayer = [{"freeTrialEligibleUser": "False", "userCountry": "US", "language": {"requested": "zh-cn", "served": "en"}, "projectName": "TensorFlow", "scriptsafe": null, "signedIn": "False", "internalUser": "False"}];
    </script>

      
        <div class="devsite-site-mask"></div>
        
  

<nav class="devsite-nav-responsive devsite-nav nocontent" tabindex="0">
  
  <div class="devsite-nav-responsive-tabs-panel">
    
      
        



<nav class="devsite-nav-responsive-tabs devsite-nav">
  <ul class="devsite-nav-list">
  
    <li class="devsite-nav-item devsite-nav-item-heading">
    
      <a 
           href="../install/index.html?nav=true"
         
         class="devsite-nav-responsive-tab devsite-nav-title gc-analytics-event
                "
         data-category="Site-Wide Custom Events" data-label="Responsive Tab: Install">
        Install
      </a>
      
    
    </li>
  
    <li class="devsite-nav-item devsite-nav-item-heading">
    
      <a 
           href="../get_started/index.html?nav=true"
         
         class="devsite-nav-responsive-tab devsite-nav-title gc-analytics-event
                "
         data-category="Site-Wide Custom Events" data-label="Responsive Tab: Develop">
        Develop
      </a>
      
    
    </li>
  
    <li class="devsite-nav-item devsite-nav-item-heading">
    
      <a 
           href="../api_docs/index.html?nav=true"
         
         class="devsite-nav-responsive-tab devsite-nav-title gc-analytics-event
                "
         data-category="Site-Wide Custom Events" data-label="Responsive Tab: API r1.5">
        API r1.5
      </a>
      
    
    </li>
  
    <li class="devsite-nav-item devsite-nav-item-heading">
    
      <span class="devsite-nav-responsive-forward devsite-nav-responsive-tab devsite-nav-title
                   devsite-nav-active gc-analytics-event"
            data-category="Site-Wide Custom Events" data-label="Responsive Tab: Deploy"
            tabindex="0">
        Deploy
      </span>
    
    </li>
  
    <li class="devsite-nav-item devsite-nav-item-heading">
    
      <a 
           href="../extend/index.html?nav=true"
         
         class="devsite-nav-responsive-tab devsite-nav-title gc-analytics-event
                "
         data-category="Site-Wide Custom Events" data-label="Responsive Tab: Extend">
        Extend
      </a>
      
    
    </li>
  
    <li class="devsite-nav-item devsite-nav-item-heading">
    
      <a 
           href="../community/index.html?nav=true"
         
         class="devsite-nav-responsive-tab devsite-nav-title gc-analytics-event
                "
         data-category="Site-Wide Custom Events" data-label="Responsive Tab: Community">
        Community
      </a>
      
    
    </li>
  
    <li class="devsite-nav-item devsite-nav-item-heading">
    
      <a 
           href="../versions/index.html?nav=true"
         
         class="devsite-nav-responsive-tab devsite-nav-title gc-analytics-event
                "
         data-category="Site-Wide Custom Events" data-label="Responsive Tab: Versions">
        Versions
      </a>
      
    
    </li>
  
    <li class="devsite-nav-item devsite-nav-item-heading">
    
      <a 
           href="../tfrc/index.html"
         
         class="devsite-nav-responsive-tab devsite-nav-title gc-analytics-event
                "
         data-category="Site-Wide Custom Events" data-label="Responsive Tab: TFRC">
        TFRC
      </a>
      
    
    </li>
  
  
  </ul>
</nav>

      
    
  </div>
  
  
  <div class="devsite-nav-responsive-sidebar-panel">
    
    <div class="devsite-nav-responsive-back" tabindex="0"></div>
    
    <nav class="devsite-nav-responsive-sidebar">
      <ul class="devsite-nav-list"><li class="devsite-nav-item"><a href="../deploy/index" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">Deploy</a></li><li class="devsite-nav-item"><a href="../deploy/distributed" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">Distributed TensorFlow</a></li><li class="devsite-nav-item"><a href="../deploy/hadoop" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">How to run TensorFlow on Hadoop</a></li><li class="devsite-nav-item devsite-nav-item-heading"><span class="devsite-nav-title devsite-nav-title-no-path" track-type="leftNav" track-name="expandNavSectionNoLink" track-metadata-position="0">TensorFlow Serving</span></li><li class="devsite-nav-item"><a href="../serving.1" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">Introduction</a></li><li class="devsite-nav-item"><a href="architecture_overview" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">Architecture Overview</a></li><li class="devsite-nav-item"><a href="setup" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">Installation</a></li><li class="devsite-nav-item devsite-nav-active"><a href="serving_basic" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">Serving a TensorFlow Model</a></li><li class="devsite-nav-item"><a href="serving_advanced" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">Building Standard TensorFlow ModelServer</a></li><li class="devsite-nav-item"><a href="serving_inception" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">Serving Inception Model with TensorFlow Serving and Kubernetes</a></li><li class="devsite-nav-item"><a href="custom_servable" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">Creating a new kind of servable</a></li><li class="devsite-nav-item"><a href="custom_source" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">Creating a module that discovers new servable paths</a></li><li class="devsite-nav-item"><a href="signature_defs" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">SignatureDefs in SavedModel for TensorFlow Serving</a></li><li class="devsite-nav-item"><a href="docker" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">Using TensorFlow Serving via Docker</a></li><li class="devsite-nav-item"><a href="https://github.com/tensorflow/serving" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">TensorFlow Serving Github</a></li><li class="devsite-nav-item"><hr class="devsite-nav-break"></li><li class="devsite-nav-item"><a href="../versions/index.html" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">TensorFlow Versions</a></li></ul>
    </nav>
  </div>
  
</nav>


        <div class="devsite-main-content clearfix">

        
        

        
  
  
    
    
      
  <nav class="devsite-section-nav devsite-nav nocontent">
    <ul class="devsite-nav-list"><li class="devsite-nav-item"><a href="../deploy/index" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">Deploy</a></li><li class="devsite-nav-item"><a href="../deploy/distributed" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">Distributed TensorFlow</a></li><li class="devsite-nav-item"><a href="../deploy/hadoop" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">How to run TensorFlow on Hadoop</a></li><li class="devsite-nav-item devsite-nav-item-heading"><span class="devsite-nav-title devsite-nav-title-no-path" track-type="leftNav" track-name="expandNavSectionNoLink" track-metadata-position="0">TensorFlow Serving</span></li><li class="devsite-nav-item"><a href="../serving.1" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">Introduction</a></li><li class="devsite-nav-item"><a href="architecture_overview" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">Architecture Overview</a></li><li class="devsite-nav-item"><a href="setup" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">Installation</a></li><li class="devsite-nav-item devsite-nav-active"><a href="serving_basic" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">Serving a TensorFlow Model</a></li><li class="devsite-nav-item"><a href="serving_advanced" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">Building Standard TensorFlow ModelServer</a></li><li class="devsite-nav-item"><a href="serving_inception" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">Serving Inception Model with TensorFlow Serving and Kubernetes</a></li><li class="devsite-nav-item"><a href="custom_servable" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">Creating a new kind of servable</a></li><li class="devsite-nav-item"><a href="custom_source" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">Creating a module that discovers new servable paths</a></li><li class="devsite-nav-item"><a href="signature_defs" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">SignatureDefs in SavedModel for TensorFlow Serving</a></li><li class="devsite-nav-item"><a href="docker" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">Using TensorFlow Serving via Docker</a></li><li class="devsite-nav-item"><a href="https://github.com/tensorflow/serving" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">TensorFlow Serving Github</a></li><li class="devsite-nav-item"><hr class="devsite-nav-break"></li><li class="devsite-nav-item"><a href="../versions/index.html" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">TensorFlow Versions</a></li></ul>
  </nav>

    

    
  <nav class="devsite-page-nav devsite-nav"></nav>


      <article class="devsite-article">
        <article class="devsite-article-inner">
  
          
  



  
  <nav class="devsite-breadcrumb-nav devsite-nav">
    


<ul class="devsite-breadcrumb-list">
  
  <li class="devsite-breadcrumb-item">
    
    
    <a href="../index.html" class="devsite-breadcrumb-link gc-analytics-event"
       data-category="Site-Wide Custom Events" data-label="Breadcrumbs"
       data-value="1">
    
    
      TensorFlow
    
    
    </a>
    
  </li>
  
  <li class="devsite-breadcrumb-item">
    
    
    <div class="devsite-breadcrumb-guillemet material-icons"></div>
    
    
    <a href="../deploy/index" class="devsite-breadcrumb-link gc-analytics-event"
       data-category="Site-Wide Custom Events" data-label="Breadcrumbs"
       data-value="2">
    
    
      Deploy
    
    
    </a>
    
  </li>
  
</ul>

  </nav>
  
  
  <h1 itemprop="name" class="devsite-page-title">
    Serving a TensorFlow Model
  </h1>
  
  
  <nav class="devsite-page-nav-embedded devsite-nav"></nav>
  
  <div class="devsite-article-body clearfix
            "
       itemprop="articleBody">
    
<script src="../_static/18908e5f48/js/managed/mathjax/MathJax.js?config=TeX-AMS-MML_SVG"></script>

<!-- DO NOT EDIT! Automatically generated file. -->


<p>This tutorial shows you how to use TensorFlow Serving components to export a
trained TensorFlow model and use the standard tensorflow_model_server to serve
it. If you are already familiar with TensorFlow Serving, and you want to know
more about how the server internals work, see the
<a href="serving_advanced">TensorFlow Serving advanced tutorial</a>.</p>
<p>This tutorial uses the simple Softmax Regression model introduced in the
TensorFlow tutorial for handwritten image (MNIST data) classification. If you
do not know what TensorFlow or MNIST is, see the
<a href="../tutorials/mnist/beginners/index.html#mnist-for-ml-beginners">MNIST For ML Beginners</a>
tutorial.</p>
<p>The code for this tutorial consists of two parts:</p>
<ul>
<li>
<p>A Python file,
    <a href="https://github.com/tensorflow/serving/tree/master/tensorflow_serving/example/mnist_saved_model.py">mnist_saved_model.py</a>,
    that trains and exports the model.</p>
</li>
<li>
<p>A ModelServer binary which can be either installed using apt-get, or
    compiled from a C++ file
    (<a href="https://github.com/tensorflow/serving/tree/master/tensorflow_serving/model_servers/main.cc">main.cc</a>).
    The TensorFlow Serving ModelServer discovers new exported models and runs a
    <a href="http://www.grpc.io">gRPC</a> service for serving them.</p>
</li>
</ul>
<p>Before getting started, please complete the
<a href="setup#prerequisites">prerequisites</a>.</p>
<aside class="note"><strong>Note:</strong><span> All <code>bazel build</code> commands below use the standard <code>-c opt</code> flag. To
further optimize the build, refer to the
<a href="setup#optimized_build">instructions here</a>.</span></aside>
<h2 id="train_and_export_tensorflow_model">Train And Export TensorFlow Model</h2>
<p>As you can see in <code>mnist_saved_model.py</code>, the training is done the same way it
is in the
<a href="../get_started/mnist/beginners">MNIST For ML Beginners tutorial</a>.
The TensorFlow graph is launched in TensorFlow session <code>sess</code>, with the input
tensor (image) as <code>x</code> and output tensor (Softmax score) as <code>y</code>.</p>
<p>Then we use TensorFlow's <a href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/saved_model/builder.py">SavedModelBuilder module</a>
to export the model. <code>SavedModelBuilder</code> saves a "snapshot" of the trained model
to reliable storage so that it can be loaded later for inference.</p>
<p>For details on the SavedModel format, please see the documentation at
<a href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/saved_model/README.md">SavedModel README.md</a>.</p>
<p>From <a href="https://github.com/tensorflow/serving/tree/master/tensorflow_serving/example/mnist_saved_model.py">mnist_saved_model.py</a>,
the following is a short code snippet to illustrate the general process of
saving a model to disk.</p>
<pre class="prettyprint lang-python"><code>export_path_base = sys.argv[-1]
export_path = os.path.join(
      compat.as_bytes(export_path_base),
      compat.as_bytes(str(FLAGS.model_version)))
print 'Exporting trained model to', export_path
builder = tf.saved_model.builder.SavedModelBuilder(export_path)
builder.add_meta_graph_and_variables(
      sess, [tag_constants.SERVING],
      signature_def_map={
           'predict_images':
               prediction_signature,
           signature_constants.DEFAULT_SERVING_SIGNATURE_DEF_KEY:
               classification_signature,
      },
      legacy_init_op=legacy_init_op)
builder.save()
</code></pre>

<p><code>SavedModelBuilder.__init__</code> takes the following argument:</p>
<ul>
<li><code>export_path</code> is the path of the export directory.</li>
</ul>
<p><code>SavedModelBuilder</code> will create the directory if it does not exist. In the
example, we concatenate the command line argument and <code>FLAGS.model_version</code> to
obtain the export directory. <code>FLAGS.model_version</code> specifies the <strong>version</strong> of
the model. You should specify a larger integer value when exporting a newer
version of the same model. Each version will be exported to a different
sub-directory under the given path.</p>
<p>You can add meta graph and variables to the builder using
<code>SavedModelBuilder.add_meta_graph_and_variables()</code> with the following arguments:</p>
<ul>
<li>
<p><code>sess</code> is the TensorFlow session that holds the trained model you are
  exporting.</p>
</li>
<li>
<p><code>tags</code> is the set of tags with which to save the meta graph. In this case,
  since we intend to use the graph in serving, we use the <code>serve</code> tag from
  predefined SavedModel tag constants. For more details, see <a href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/saved_model/tag_constants.py">tag_constants.py</a>
  and <a href="../api_docs/python/tf/saved_model/tag_constants">related TensorFlow API documentation</a>.</p>
</li>
<li>
<p><code>signature_def_map</code> specifies the map of user-supplied key for a
  <strong>signature</strong> to a tensorflow::SignatureDef to add to the meta graph.
  Signature specifies what type of model is being exported, and the
  input/output tensors to bind to when running inference.</p>
</li>
</ul>
<p>The special signature key <code>serving_default</code> specifies the default serving
  signature. The default serving signature def key, along with other constants
  related to signatures, are defined as part of SavedModel signature constants.
  For more details, see <a href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/saved_model/signature_constants.py">signature_constants.py</a>
  and related <a href="../api_docs/python/tf/saved_model/signature_constants">TensorFlow 1.0 API documentation</a>.</p>
<p>Further, to help build signature defs easily, the SavedModel API provides
  <a href="../api_docs/python/tf/saved_model/signature_def_utils">signature def utils</a>.
  Specifically, in the <code>mnist_saved_model.py</code> code snippet above, we use
  <code>signature_def_utils.build_signature_def()</code> to build <code>predict_signature</code> and
  <code>classification_signature</code>.</p>
<p>As an example for how <code>predict_signature</code> is defined, the util takes the
  following arguments:</p>
<ul>
<li>
<p><code>inputs={'images': tensor_info_x}</code> specifies the input tensor info.</p>
</li>
<li>
<p><code>outputs={'scores': tensor_info_y}</code> specifies the scores tensor info.</p>
</li>
<li>
<p><code>method_name</code> is the method used for the inference. For Prediction
     requests, it should be set to <code>tensorflow/serving/predict</code>. For other
     method names, see <a href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/saved_model/signature_constants.py">signature_constants.py</a>
     and related <a href="../api_docs/python/tf/saved_model/signature_constants">TensorFlow 1.0 API documentation</a>.</p>
</li>
</ul>
<p>Note that <code>tensor_info_x</code> and <code>tensor_info_y</code> have the structure of
<code>tensorflow::TensorInfo</code> protocol buffer defined <a href="../code/tensorflow/core/protobuf/meta_graph.proto?hl=zh-cn">here</a>.
To easily build tensor infos, the TensorFlow SavedModel API also provides
<a href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/saved_model/utils.py">utils.py</a>,
with <a href="../api_docs/python/tf/saved_model/utils">related TensorFlow 1.0 API documentation</a>.</p>
<p>Also, note that <code>images</code> and <code>scores</code> are tensor alias names. They can be
whatever unique strings you want, and they will become the logical names
of tensor <code>x</code> and <code>y</code> that you refer to for tensor binding when sending
prediction requests later.</p>
<p>For instance, if <code>x</code> refers to the tensor with name 'long_tensor_name_foo' and
<code>y</code> refers to the tensor with name 'generated_tensor_name_bar', <code>builder</code> will
store tensor logical name to real name mapping ('images' -&gt;
'long_tensor_name_foo') and ('scores' -&gt; 'generated_tensor_name_bar').  This
allows the user to refer to these tensors with their logical names when
running inference.</p>
<aside class="note"><strong>Note:</strong><span> In addition to the description above, documentation related to signature
def structure and how to set up them up can be found <a href="signature_defs">here</a>.</span></aside>
<p>Let's run it!</p>
<p>Clear the export directory if it already exists:</p>
<pre class="prettyprint lang-shell"><code>$&gt;rm -rf /tmp/mnist_model
</code></pre>

<p>If you would like to install the <code>tensorflow</code> and <code>tensorflow-serving-api</code> PIP
packages, you can run all Python code (export and client) using a simple
<code>python</code> command. To install the PIP package, follow the
<a href="setup#tensorflow_serving_python_api_pip_package">instructions here</a>.
It's also possible to
use Bazel to build the necessary dependencies and run all code without
installing those packages. The rest of the codelab will have instructions for
both the Bazel and PIP options.</p>
<p>Bazel:</p>
<pre class="prettyprint lang-shell"><code>$&gt;bazel build -c opt //tensorflow_serving/example:mnist_saved_model
$&gt;bazel-bin/tensorflow_serving/example/mnist_saved_model /tmp/mnist_model
Training model...

...

Done training!
Exporting trained model to /tmp/mnist_model
Done exporting!
</code></pre>

<p>Or if you have <code>tensorflow-serving-api</code> installed, you can run:</p>
<pre class="prettyprint lang-shell"><code>python tensorflow_serving/example/mnist_saved_model.py /tmp/mnist_model
</code></pre>

<p>Now let's take a look at the export directory.</p>
<pre class="prettyprint lang-shell"><code>$&gt;ls /tmp/mnist_model
1
</code></pre>

<p>As mentioned above, a sub-directory will be created for exporting each version
of the model. <code>FLAGS.model_version</code> has the default value of 1, therefore
the corresponding sub-directory <code>1</code> is created.</p>
<pre class="prettyprint lang-shell"><code>$&gt;ls /tmp/mnist_model/1
saved_model.pb variables
</code></pre>

<p>Each version sub-directory contains the following files:</p>
<ul>
<li>
<p><code>saved_model.pb</code> is the serialized tensorflow::SavedModel. It includes
  one or more graph definitions of the model, as well as metadata of the
  model such as signatures.</p>
</li>
<li>
<p><code>variables</code> are files that hold the serialized variables of the graphs.</p>
</li>
</ul>
<p>With that, your TensorFlow model is exported and ready to be loaded!</p>
<h2 id="load_exported_model_with_standard_tensorflow_modelserver">Load Exported Model With Standard TensorFlow ModelServer</h2>
<p>If you'd like to use a locally compiled ModelServer, run the following:</p>
<pre class="prettyprint lang-shell"><code>$&gt;bazel build -c opt //tensorflow_serving/model_servers:tensorflow_model_server
$&gt;bazel-bin/tensorflow_serving/model_servers/tensorflow_model_server --port=9000 --model_name=mnist --model_base_path=/tmp/mnist_model/
</code></pre>

<p>If you'd prefer to skip compilation and install using apt-get, follow the
<a href="setup#installing_using_apt-get">instructions here</a>. Then run the server with
the following command:</p>
<pre class="prettyprint lang-shell"><code>tensorflow_model_server --port=9000 --model_name=mnist --model_base_path=/tmp/mnist_model/
</code></pre>

<h2 id="test_the_server">Test The Server</h2>
<p>We can use the provided
<a href="https://github.com/tensorflow/serving/tree/master/tensorflow_serving/example/mnist_client.py">mnist_client</a>
utility to test the server. The client downloads MNIST test data, sends them as
requests to the server, and calculates the inference error rate.</p>
<p>To run it with Bazel:</p>
<pre class="prettyprint lang-shell"><code>$&gt;bazel build -c opt //tensorflow_serving/example:mnist_client
$&gt;bazel-bin/tensorflow_serving/example/mnist_client --num_tests=1000 --server=localhost:9000
...
Inference error rate: 10.5%
</code></pre>

<p>Alternatively if you installed the PIP package, run:</p>
<pre class="prettyprint lang-shell"><code>python tensorflow_serving/example/mnist_client.py --num_tests=1000 --server=localhost:9000
</code></pre>

<p>We expect around 91% accuracy for the trained Softmax model and we get
10.5% inference error rate for the first 1000 test images. This confirms that
the server loads and runs the trained model successfully!</p>

  </div>
  

  
        
  







        
<div class="devsite-content-footer nocontent">
  
  
    <p>Except as otherwise noted, the content of this page is licensed under the <a href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0 License</a>, and code samples are licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 License</a>. For details, see our <a href="https://developers.google.cn/terms/site-policies">Site Policies</a>. Java is a registered trademark of Oracle and/or its affiliates.</p>
  

  
    
    <p class="devsite-content-footer-date" itemprop="datePublished"
       content="2018-01-27T01:30:38.083060">
      
      上次更新日期：一月 27, 2018
    </p>
  

</div>

        </article>
      </article>
  

        </div>
      

<footer class="devsite-footer-linkboxes nocontent
               devsite-footer-linkboxes-all-backup
               "><nav class="devsite-full-site-width"><ul class="devsite-footer-linkboxes-list"><li class="devsite-footer-linkbox devsite-footer-linkbox-backup"><h3 class="devsite-footer-linkbox-heading">把握动态</h3><ul class="devsite-footer-linkbox-list"><li class="devsite-footer-linkbox-item"><a href="https://research.googleblog.com/search/label/TensorFlow" class="gc-analytics-event"
               data-category="Site-Wide Custom Events"
               data-label="Footer Blog Link">
                博客
            </a></li><li class="devsite-footer-linkbox-item"><a href="https://github.com/tensorflow/" class="gc-analytics-event"
               data-category="Site-Wide Custom Events"
               data-label="Footer GitHub Link">
                GitHub
            </a></li><li class="devsite-footer-linkbox-item"><a href="https://twitter.com/tensorflow" class="gc-analytics-event"
               data-category="Site-Wide Custom Events"
               data-label="Footer Twitter Link">
                Twitter
            </a></li></ul></li><li class="devsite-footer-linkbox devsite-footer-linkbox-backup"><h3 class="devsite-footer-linkbox-heading">支持</h3><ul class="devsite-footer-linkbox-list"><li class="devsite-footer-linkbox-item"><a href="https://github.com/tensorflow/tensorflow/issues" class="gc-analytics-event"
               data-category="Site-Wide Custom Events"
               data-label="Footer Issue Tracker Link">
                问题跟踪器
            </a></li><li class="devsite-footer-linkbox-item"><a href="https://github.com/tensorflow/tensorflow/blob/master/RELEASE.md" class="gc-analytics-event"
               data-category="Site-Wide Custom Events"
               data-label="Footer Release Notes Link">
                版本说明
            </a></li><li class="devsite-footer-linkbox-item"><a href="https://stackoverflow.com/questions/tagged/tensorflow" class="gc-analytics-event"
               data-category="Site-Wide Custom Events"
               data-label="Footer Stack Overflow Link">
                Stack Overflow
            </a></li></ul></li></ul></nav></footer><footer class="devsite-utility-footer"><nav class="devsite-utility-footer-nav devsite-nav devsite-full-site-width"><div class="devsite-utility-footer-nav-left"><form class="devsite-utility-footer-language" action="https://tensorflow.google.cn/i18n/setlang/" method="post"><input type="hidden" name="xsrf_token" value="U6D-_ZsMF7fK7YTjAEFPmK6vhppcmG86SQEcoUJAckg6MTUxNzg2MDI3NjQ3NjY5MA" /><input type="hidden" name="next" value="/serving/serving_basic"><select class="devsite-utility-footer-language-select kd-select" name="language"
                track-type="languageSelector" track-name="click"><option value="en"
                
                track-type="languageSelector" track-name="changed"
                track-metadata-original-language="zh-cn"
                track-metadata-selected-language="en">
            English
          </option><option value="zh-cn"
                 selected="selected" 
                track-type="languageSelector" track-name="changed"
                track-metadata-original-language="zh-cn"
                track-metadata-selected-language="zh-cn">
            简体中文
          </option></select></form><span class="devsite-utility-footer-links"><a class="devsite-utility-footer-link gc-analytics-event"
           href="http://www.google.cn/policies/terms/"
           data-category="Site-Wide Custom Events"
           data-label="Footer terms link"
           data-footer-link-id="terms"
           >条款
         </a><a class="devsite-utility-footer-link gc-analytics-event"
           href="http://www.google.cn/policies/privacy/"
           data-category="Site-Wide Custom Events"
           data-label="Footer privacy link"
           data-footer-link-id="privacy"
           
           data-cookie-policy="//www.google.cn/policies/technologies/cookies/"
           >隐私权
         </a></span></div></nav></footer></div><script async defer src="https://www.gstatic.com/feedback/api.js"></script><script src="../_static2/18908e5f48/jsi18n/index.html"></script><script src="../_static/18908e5f48/js/script_foot_closure__zh_cn.js"></script><script src="../_static/18908e5f48/js/script_foot.js"></script><script>
        (function($) {
          
          devsite.devsite.Init($, {'FULL_SITE_SEARCH_ENABLED': 0, 'ENABLE_BLOCKED_VIDEO_PLACEHOLDER': 1, 'VERSION_HASH': '18908e5f48', 'SITE_NAME': 'tensorflow_china', 'HISTORY_ENABLED': 0, 'ENABLE_BLOCKED_LINK_TOOLTIP': 1, 'ALLOWED_HOSTS': ['.android.com', '.anvato.com', '.apigee.com', '.appspot.com', '.dialogflow.com', '.gonglchuangl.net', '.google.cn', '.google.com', '.googleplex.com', '.nest.com', '.openthread.io', '.openweave.io', '.orbitera.com', '.tensorflow.org'], 'BLOCK_RSS_FEEDS': 1, 'SCRIPTSAFE_DOMAIN': 'tensorflow-dot-google-developers.gonglchuangl.net'},
                               '[]','zh-cn',
                               true, '',
                               {"f62218c009ec029abef196bba5aa34cf": true, "098dafe57affddc137df300142652cfd": false, "8e03e230de0bd8a6fe173fdf172e8b3f": true, "cb025a64a50094835616312f4774a53d": true, "51470233c56fc1fde50f00b73c52b216": false, "d169d485cf24243a263783dbe42029b1": true, "039e5d84b87fd75807ffb37b7f1bbf2c": true, "752953480de00a336d911a46966cc16d": false, "700def1a83e356c06c0925afb05de4b0": false, "6749dcb526ce9bde6993550c7d928d24": true}, '/',
                               'https://tensorflow.google.cn/');
        })(jQuery);

        
        devsite.localInit = function() {
          
        };

      </script><script>
      $('.devsite-utility-footer-language-select').each(function() {
        $(this).change(function(){$('.devsite-utility-footer-language').submit();});
      });
      </script></div><span id="devsite-request-elapsed" data-request-elapsed="325.419902802"></span></body></html>
