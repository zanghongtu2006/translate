




<!DOCTYPE html><html lang="en"
      class="chekov"><head><script>var a=window.devsite||{};window.devsite=a;a.readyCallbacks=[];window.devsite.readyCallbacks=a.readyCallbacks;a.ready=function(b){a.readyCallbacks.push(b)};window.devsite.ready=a.ready;
</script><meta charset="utf-8"><meta name="xsrf_token" content="v_q5Wb0wb8fFAh5_LkcHiN8SCwQe7Bxhi_VmvxKNP_Q6MTUxNzg3MjYzNDU5NTM2MA" /><link rel="canonical" href="https://www.tensorflow.org/tutorials/deep_cnn"><link rel="alternate" href="https://www.tensorflow.org/tutorials/deep_cnn" hreflang="en"><link rel="alternate" href="deep_cnn" hreflang="en-cn"><link rel="alternate" href="https://www.tensorflow.org/tutorials/deep_cnn" hreflang="x-default"><link rel="shortcut icon" href="../_static/18908e5f48/images/tensorflow/favicon.png"><link rel="apple-touch-icon" href="../images/apple-touch-icon-180x180.png"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Roboto:300,400,400italic,500,500italic,700,700italic|Roboto+Mono:400,500,700|Material+Icons"><link rel="stylesheet"
        href="../_static/18908e5f48/css/devsite-tensorflow-orange.css"><script src="../_static/18908e5f48/js/jquery-bundle.js"></script><meta property="og:site_name" content="TensorFlow"><meta property="og:type" content="website"><meta property="og:url" content="https://www.tensorflow.org/tutorials/deep_cnn"><meta property="og:locale" content="en"><script>
    var ___gcfg = ___gcfg || {};
    ___gcfg.lang = 'zh-cn';
  </script><title>Convolutional Neural Networks &nbsp;|&nbsp; TensorFlow</title><meta property="og:title" content="Convolutional Neural Networks &nbsp;|&nbsp; TensorFlow"></head><body class="
               devsite-doc-page
               
               
               
               
               "
        id="top_of_page"><div class="devsite-wrapper"><div class="devsite-top-section-wrapper
            "><header class="devsite-top-section nocontent"><div class="devsite-top-logo-row-wrapper-wrapper"><div class="devsite-top-logo-row-wrapper"><div class="devsite-top-logo-row devsite-full-site-width"><button type="button" class="devsite-expand-section-nav devsite-header-icon-button
                                       button-flat material-icons gc-analytics-event"
                  data-category="Site-Wide Custom Events" data-label="Hamburger menu"></button><div class="devsite-product-name-wrapper"><a href="../index.html" class="devsite-site-logo-link gc-analytics-event"
   data-category="Site-Wide Custom Events" data-label="Site logo"><img src="../_static/18908e5f48/images/tensorflow/lockup.png"
       class="devsite-site-logo" alt="TensorFlow"><span class="devsite-site-name devsite-product-name">TensorFlow</span></a></div><div class="devsite-header-upper-tabs"><nav class="devsite-doc-set-nav devsite-nav devsite-overflow-tabs-scroll-wrapper"><ul class="devsite-doc-set-nav-tab-list devsite-overflow-tabs-scroll"><li class="devsite-doc-set-nav-tab-container"><a href="../install/index"
         class="
                devsite-doc-set-nav-tab gc-analytics-event"
       
         data-category="Site-Wide Custom Events"
       
         data-label="Tab: Install"
       >
        Install
      </a></li><li class="devsite-doc-set-nav-tab-container"><a href="../get_started/index"
         class="devsite-doc-set-nav-active
                devsite-doc-set-nav-tab gc-analytics-event"
       
         data-category="Site-Wide Custom Events"
       
         data-label="Tab: Develop"
       >
        Develop
      </a></li><li class="devsite-doc-set-nav-tab-container"><a href="../api_docs.1"
         class="
                devsite-doc-set-nav-tab gc-analytics-event"
       
         data-category="Site-Wide Custom Events"
       
         data-label="Tab: API r1.5"
       >
        API r1.5
      </a></li><li class="devsite-doc-set-nav-tab-container"><a href="../deploy/index"
         class="
                devsite-doc-set-nav-tab gc-analytics-event"
       
         data-category="Site-Wide Custom Events"
       
         data-label="Tab: Deploy"
       >
        Deploy
      </a></li><li class="devsite-doc-set-nav-tab-container"><a href="../extend/index.html"
         class="
                devsite-doc-set-nav-tab gc-analytics-event"
       
         data-category="Site-Wide Custom Events"
       
         data-label="Tab: Extend"
       >
        Extend
      </a></li><li class="devsite-doc-set-nav-tab-container"><a href="../community/index.html"
         class="
                devsite-doc-set-nav-tab gc-analytics-event"
       
         data-category="Site-Wide Custom Events"
       
         data-label="Tab: Community"
       >
        Community
      </a></li><li class="devsite-doc-set-nav-tab-container"><a href="../versions/index.html"
         class="
                devsite-doc-set-nav-tab gc-analytics-event"
       
         data-category="Site-Wide Custom Events"
       
         data-label="Tab: Versions"
       >
        Versions
      </a></li><li class="devsite-doc-set-nav-tab-container"><a href="../tfrc/index.html"
         class="
                devsite-doc-set-nav-tab gc-analytics-event"
       
         data-category="Site-Wide Custom Events"
       
         data-label="Tab: TFRC"
       >
        TFRC
      </a></li></ul></nav></div><form class="devsite-search-form"
                action="https://tensorflow.google.cn/s/results/"
                method="GET"
                id="top-search"
                search-placeholder='搜索'><div id="searchbox" class="devsite-searchbox"><input placeholder='搜索'
         
         type="text"
         class="devsite-search-field devsite-search-query"
         name="q"
         value=""
         autocomplete="off"><div class="devsite-search-image material-icons"></div></div><input type="hidden"
       name="p"
       id="search_project"
       value="/"
       data-project-name="TensorFlow"
       data-project-path="/"
       data-query-match=""><input type="hidden" class="suggest-project" value="TensorFlow" /><div class="suggest-project-metadata" data-home_url="/" data-path="/" data-name="Android Developers" ></div><div class="suggest-project-metadata" data-home_url="/" data-path="/" data-name="Android Open Source Project" ></div><div class="suggest-project-metadata" data-home_url="/" data-path="/" data-name="Google Cloud Platform" ></div><div class="suggest-project-metadata" data-home_url="/" data-path="/" data-name="Dialogflow" ></div><div class="suggest-project-metadata" data-home_url="/" data-path="/" data-name="Firebase" ></div><div class="suggest-project-metadata" data-home_url="/" data-path="/" data-name="Link.app" ></div><div class="suggest-project-metadata" data-home_url="/" data-path="/" data-name="Nest Developers" ></div><div class="suggest-project-metadata" data-home_url="/" data-path="/" data-name="OpenThread" ></div><div class="suggest-project-metadata" data-home_url="/" data-path="/" data-name="TensorFlow" ></div></form><button type="button" class="devsite-search-button devsite-header-icon-button button-flat
                                       material-icons"></button></div></div></div><div class="devsite-collapsible-section"><div class="devsite-header-background devsite-full-site-width"><div class="devsite-product-id-row devsite-full-site-width"><div class="devsite-product-description-row"><ul class="devsite-breadcrumb-list"><li class="devsite-breadcrumb-item">
    
    
    
      Develop
    
    
  </li></ul></div></div><div class="devsite-doc-set-nav-row devsite-full-site-width"><nav class="devsite-doc-set-nav devsite-nav devsite-overflow-tabs-scroll-wrapper"><ul class="devsite-doc-set-nav-tab-list devsite-overflow-tabs-scroll"><li class="devsite-doc-set-nav-tab-container"><a href="../get_started/index"
         class="
                devsite-doc-set-nav-tab gc-analytics-event"
       
         data-category="Site-Wide Custom Events"
       
         data-label="Tab: Get Started"
       >
        Get Started
      </a></li><li class="devsite-doc-set-nav-tab-container"><a href="../programmers_guide/index.html"
         class="
                devsite-doc-set-nav-tab gc-analytics-event"
       
         data-category="Site-Wide Custom Events"
       
         data-label="Tab: Programmer&#39;s Guide"
       >
        Programmer&#39;s Guide
      </a></li><li class="devsite-doc-set-nav-tab-container"><a href="index.html"
         class="devsite-doc-set-nav-active
                devsite-doc-set-nav-tab gc-analytics-event"
       
         data-category="Site-Wide Custom Events"
       
         data-label="Tab: Tutorials"
       >
        Tutorials
      </a></li><li class="devsite-doc-set-nav-tab-container"><a href="../performance/index.html"
         class="
                devsite-doc-set-nav-tab gc-analytics-event"
       
         data-category="Site-Wide Custom Events"
       
         data-label="Tab: Performance"
       >
        Performance
      </a></li><li class="devsite-doc-set-nav-tab-container"><a href="../mobile/index.html"
         class="
                devsite-doc-set-nav-tab gc-analytics-event"
       
         data-category="Site-Wide Custom Events"
       
         data-label="Tab: Mobile"
       >
        Mobile
      </a></li></ul></nav></div></div></div></header><script>
    if (window.jQuery) {
      $(document).ready(function() {
        if (window.devsite && window.devsite.search) {
          
          window.devsite.search.init('zh-cn')
        }
      });
    }
  </script></div><div id="gc-wrapper"itemscope itemtype="http://schema.org/Article"><input class="google-analytics-id-json" type="hidden" value="{&quot;dimensions&quot;: {&quot;dimension6&quot;: &quot;en&quot;, &quot;dimension4&quot;: &quot;TensorFlow&quot;, &quot;dimension5&quot;: &quot;zh-cn&quot;, &quot;dimension3&quot;: false, &quot;dimension1&quot;: &quot;Signed out&quot;, &quot;dimension8&quot;: null}, &quot;gaid&quot;: &quot;UA-69864048-6&quot;}"><script>
      var dataLayer = [{"freeTrialEligibleUser": "False", "userCountry": "US", "language": {"requested": "zh-cn", "served": "en"}, "projectName": "TensorFlow", "scriptsafe": null, "signedIn": "False", "internalUser": "False"}];
    </script>

      
        <div class="devsite-site-mask"></div>
        
  

<nav class="devsite-nav-responsive devsite-nav nocontent" tabindex="0">
  
  <div class="devsite-nav-responsive-tabs-panel">
    
      
        



<nav class="devsite-nav-responsive-tabs devsite-nav">
  <ul class="devsite-nav-list">
  
    <li class="devsite-nav-item devsite-nav-item-heading">
    
      <a 
           href="../install/index.html?nav=true"
         
         class="devsite-nav-responsive-tab devsite-nav-title gc-analytics-event
                "
         data-category="Site-Wide Custom Events" data-label="Responsive Tab: Install">
        Install
      </a>
      
    
    </li>
  
    <li class="devsite-nav-item devsite-nav-item-heading">
    
      <a 
           href="../get_started/index.html?nav=true"
         
         class="devsite-nav-responsive-tab devsite-nav-title gc-analytics-event
                devsite-nav-active"
         data-category="Site-Wide Custom Events" data-label="Responsive Tab: Develop">
        Develop
      </a>
      
        



<nav class="devsite-nav-responsive-tabs devsite-nav">
  <ul class="devsite-nav-list">
  
    <li class="devsite-nav-item devsite-nav-item-heading">
    
      <a 
           href="../get_started/index.html?nav=true"
         
         class="devsite-nav-responsive-tab devsite-nav-title gc-analytics-event
                "
         data-category="Site-Wide Custom Events" data-label="Responsive Tab: Get Started">
        Get Started
      </a>
      
    
    </li>
  
    <li class="devsite-nav-item devsite-nav-item-heading">
    
      <a 
           href="../programmers_guide/index.html?nav=true"
         
         class="devsite-nav-responsive-tab devsite-nav-title gc-analytics-event
                "
         data-category="Site-Wide Custom Events" data-label="Responsive Tab: Programmer&#39;s Guide">
        Programmer&#39;s Guide
      </a>
      
    
    </li>
  
    <li class="devsite-nav-item devsite-nav-item-heading">
    
      <span class="devsite-nav-responsive-forward devsite-nav-responsive-tab devsite-nav-title
                   devsite-nav-active gc-analytics-event"
            data-category="Site-Wide Custom Events" data-label="Responsive Tab: Tutorials"
            tabindex="0">
        Tutorials
      </span>
    
    </li>
  
    <li class="devsite-nav-item devsite-nav-item-heading">
    
      <a 
           href="../performance/index.html?nav=true"
         
         class="devsite-nav-responsive-tab devsite-nav-title gc-analytics-event
                "
         data-category="Site-Wide Custom Events" data-label="Responsive Tab: Performance">
        Performance
      </a>
      
    
    </li>
  
    <li class="devsite-nav-item devsite-nav-item-heading">
    
      <a 
           href="../mobile/index.html?nav=true"
         
         class="devsite-nav-responsive-tab devsite-nav-title gc-analytics-event
                "
         data-category="Site-Wide Custom Events" data-label="Responsive Tab: Mobile">
        Mobile
      </a>
      
    
    </li>
  
  
  </ul>
</nav>

      
    
    </li>
  
    <li class="devsite-nav-item devsite-nav-item-heading">
    
      <a 
           href="../api_docs/index.html?nav=true"
         
         class="devsite-nav-responsive-tab devsite-nav-title gc-analytics-event
                "
         data-category="Site-Wide Custom Events" data-label="Responsive Tab: API r1.5">
        API r1.5
      </a>
      
    
    </li>
  
    <li class="devsite-nav-item devsite-nav-item-heading">
    
      <a 
           href="../deploy/index.html?nav=true"
         
         class="devsite-nav-responsive-tab devsite-nav-title gc-analytics-event
                "
         data-category="Site-Wide Custom Events" data-label="Responsive Tab: Deploy">
        Deploy
      </a>
      
    
    </li>
  
    <li class="devsite-nav-item devsite-nav-item-heading">
    
      <a 
           href="../extend/index.html?nav=true"
         
         class="devsite-nav-responsive-tab devsite-nav-title gc-analytics-event
                "
         data-category="Site-Wide Custom Events" data-label="Responsive Tab: Extend">
        Extend
      </a>
      
    
    </li>
  
    <li class="devsite-nav-item devsite-nav-item-heading">
    
      <a 
           href="../community/index.html?nav=true"
         
         class="devsite-nav-responsive-tab devsite-nav-title gc-analytics-event
                "
         data-category="Site-Wide Custom Events" data-label="Responsive Tab: Community">
        Community
      </a>
      
    
    </li>
  
    <li class="devsite-nav-item devsite-nav-item-heading">
    
      <a 
           href="../versions/index.html?nav=true"
         
         class="devsite-nav-responsive-tab devsite-nav-title gc-analytics-event
                "
         data-category="Site-Wide Custom Events" data-label="Responsive Tab: Versions">
        Versions
      </a>
      
    
    </li>
  
    <li class="devsite-nav-item devsite-nav-item-heading">
    
      <a 
           href="../tfrc/index.html"
         
         class="devsite-nav-responsive-tab devsite-nav-title gc-analytics-event
                "
         data-category="Site-Wide Custom Events" data-label="Responsive Tab: TFRC">
        TFRC
      </a>
      
    
    </li>
  
  
  </ul>
</nav>

      
    
  </div>
  
  
  <div class="devsite-nav-responsive-sidebar-panel">
    
    <div class="devsite-nav-responsive-back" tabindex="0"></div>
    
    <nav class="devsite-nav-responsive-sidebar">
      <ul class="devsite-nav-list"><li class="devsite-nav-item"><a href="index.html" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">Tutorials</a></li><li class="devsite-nav-item devsite-nav-item-heading"><span class="devsite-nav-title devsite-nav-title-no-path" track-type="leftNav" track-name="expandNavSectionNoLink" track-metadata-position="0">Images</span></li><li class="devsite-nav-item"><a href="mnist/beginners/index.html" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">A Guide to TF Layers: Building a Convolutional Neural Network</a></li><li class="devsite-nav-item"><a href="image_recognition" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">Image Recognition</a></li><li class="devsite-nav-item"><a href="image_retraining" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">How to Retrain Inception's Final Layer for New Categories</a></li><li class="devsite-nav-item devsite-nav-active"><a href="deep_cnn" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">Convolutional Neural Networks</a></li><li class="devsite-nav-item devsite-nav-item-heading"><span class="devsite-nav-title devsite-nav-title-no-path" track-type="leftNav" track-name="expandNavSectionNoLink" track-metadata-position="0">Sequences</span></li><li class="devsite-nav-item"><a href="recurrent" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">Recurrent Neural Networks</a></li><li class="devsite-nav-item"><a href="seq2seq" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">Neural Machine Translation (seq2seq) Tutorial</a></li><li class="devsite-nav-item"><a href="recurrent_quickdraw" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">Recurrent Neural Networks for Drawing Classification</a></li><li class="devsite-nav-item"><a href="audio_recognition" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">Simple Audio Recognition</a></li><li class="devsite-nav-item devsite-nav-item-heading"><span class="devsite-nav-title devsite-nav-title-no-path" track-type="leftNav" track-name="expandNavSectionNoLink" track-metadata-position="0">Data Representation</span></li><li class="devsite-nav-item"><a href="wide" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">TensorFlow Linear Model Tutorial</a></li><li class="devsite-nav-item"><a href="wide_and_deep" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">TensorFlow Wide &amp; Deep Learning Tutorial</a></li><li class="devsite-nav-item"><a href="word2vec" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">Vector Representations of Words</a></li><li class="devsite-nav-item"><a href="kernel_methods" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">Improving Linear Models Using Explicit Kernel Methods</a></li><li class="devsite-nav-item devsite-nav-item-heading"><span class="devsite-nav-title devsite-nav-title-no-path" track-type="leftNav" track-name="expandNavSectionNoLink" track-metadata-position="0">Non-ML</span></li><li class="devsite-nav-item"><a href="mandelbrot" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">Mandelbrot Set</a></li><li class="devsite-nav-item"><a href="pdes" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">Partial Differential Equations</a></li><li class="devsite-nav-item"><hr class="devsite-nav-break"></li><li class="devsite-nav-item"><a href="../versions/index.html" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">TensorFlow Versions</a></li></ul>
    </nav>
  </div>
  
</nav>


        <div class="devsite-main-content clearfix">

        
        

        
  
  
    
    
      
  <nav class="devsite-section-nav devsite-nav nocontent">
    <ul class="devsite-nav-list"><li class="devsite-nav-item"><a href="index.html" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">Tutorials</a></li><li class="devsite-nav-item devsite-nav-item-heading"><span class="devsite-nav-title devsite-nav-title-no-path" track-type="leftNav" track-name="expandNavSectionNoLink" track-metadata-position="0">Images</span></li><li class="devsite-nav-item"><a href="mnist/beginners/index.html" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">A Guide to TF Layers: Building a Convolutional Neural Network</a></li><li class="devsite-nav-item"><a href="image_recognition" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">Image Recognition</a></li><li class="devsite-nav-item"><a href="image_retraining" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">How to Retrain Inception's Final Layer for New Categories</a></li><li class="devsite-nav-item devsite-nav-active"><a href="deep_cnn" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">Convolutional Neural Networks</a></li><li class="devsite-nav-item devsite-nav-item-heading"><span class="devsite-nav-title devsite-nav-title-no-path" track-type="leftNav" track-name="expandNavSectionNoLink" track-metadata-position="0">Sequences</span></li><li class="devsite-nav-item"><a href="recurrent" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">Recurrent Neural Networks</a></li><li class="devsite-nav-item"><a href="seq2seq" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">Neural Machine Translation (seq2seq) Tutorial</a></li><li class="devsite-nav-item"><a href="recurrent_quickdraw" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">Recurrent Neural Networks for Drawing Classification</a></li><li class="devsite-nav-item"><a href="audio_recognition" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">Simple Audio Recognition</a></li><li class="devsite-nav-item devsite-nav-item-heading"><span class="devsite-nav-title devsite-nav-title-no-path" track-type="leftNav" track-name="expandNavSectionNoLink" track-metadata-position="0">Data Representation</span></li><li class="devsite-nav-item"><a href="wide" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">TensorFlow Linear Model Tutorial</a></li><li class="devsite-nav-item"><a href="wide_and_deep" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">TensorFlow Wide &amp; Deep Learning Tutorial</a></li><li class="devsite-nav-item"><a href="word2vec" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">Vector Representations of Words</a></li><li class="devsite-nav-item"><a href="kernel_methods" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">Improving Linear Models Using Explicit Kernel Methods</a></li><li class="devsite-nav-item devsite-nav-item-heading"><span class="devsite-nav-title devsite-nav-title-no-path" track-type="leftNav" track-name="expandNavSectionNoLink" track-metadata-position="0">Non-ML</span></li><li class="devsite-nav-item"><a href="mandelbrot" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">Mandelbrot Set</a></li><li class="devsite-nav-item"><a href="pdes" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">Partial Differential Equations</a></li><li class="devsite-nav-item"><hr class="devsite-nav-break"></li><li class="devsite-nav-item"><a href="../versions/index.html" class="devsite-nav-title gc-analytics-event" track-type="leftNav" track-name="titleLink" track-metadata-position="0" data-category="Site-Wide Custom Events" data-label="Left nav" data-action="click">TensorFlow Versions</a></li></ul>
  </nav>

    

    
  <nav class="devsite-page-nav devsite-nav"></nav>


      <article class="devsite-article">
        <article class="devsite-article-inner">
  
          
  



  
  <nav class="devsite-breadcrumb-nav devsite-nav">
    


<ul class="devsite-breadcrumb-list">
  
  <li class="devsite-breadcrumb-item">
    
    
    <a href="../index.html" class="devsite-breadcrumb-link gc-analytics-event"
       data-category="Site-Wide Custom Events" data-label="Breadcrumbs"
       data-value="1">
    
    
      TensorFlow
    
    
    </a>
    
  </li>
  
  <li class="devsite-breadcrumb-item">
    
    
    <div class="devsite-breadcrumb-guillemet material-icons"></div>
    
    
    <a href="../get_started/index" class="devsite-breadcrumb-link gc-analytics-event"
       data-category="Site-Wide Custom Events" data-label="Breadcrumbs"
       data-value="2">
    
    
      Develop
    
    
    </a>
    
  </li>
  
  <li class="devsite-breadcrumb-item">
    
    
    <div class="devsite-breadcrumb-guillemet material-icons"></div>
    
    
    <a href="index.html" class="devsite-breadcrumb-link gc-analytics-event"
       data-category="Site-Wide Custom Events" data-label="Breadcrumbs"
       data-value="3">
    
    
      Tutorials
    
    
    </a>
    
  </li>
  
</ul>

  </nav>
  
  
  <h1 itemprop="name" class="devsite-page-title">
    Convolutional Neural Networks
  </h1>
  
  
  <nav class="devsite-page-nav-embedded devsite-nav"></nav>
  
  <div class="devsite-article-body clearfix
            "
       itemprop="articleBody">
    
<script src="../_static/18908e5f48/js/managed/mathjax/MathJax.js?config=TeX-AMS-MML_SVG"></script>

<!-- DO NOT EDIT! Automatically generated file. -->


<blockquote>
<p><strong>NOTE:</strong> This tutorial is intended for <em>advanced</em> users of TensorFlow
and assumes expertise and experience in machine learning.</p>
</blockquote>
<h2 id="overview">Overview</h2>
<p>CIFAR-10 classification is a common benchmark problem in machine learning.  The
problem is to classify RGB 32x32 pixel images across 10 categories:</p>
<pre class="prettyprint"><code>airplane, automobile, bird, cat, deer, dog, frog, horse, ship, and truck.
</code></pre>

<p>For more details refer to the <a href="https://www.cs.toronto.edu/~kriz/cifar.html">CIFAR-10 page</a>
and a <a href="https://www.cs.toronto.edu/~kriz/learning-features-2009-TR.pdf">Tech Report</a>
by Alex Krizhevsky.</p>
<h3 id="goals">Goals</h3>
<p>The goal of this tutorial is to build a relatively small <a href="https://en.wikipedia.org/wiki/Convolutional_neural_network">convolutional neural
network</a> (CNN) for
recognizing images. In the process, this tutorial:</p>
<ol>
<li>Highlights a canonical organization for network architecture,
training and evaluation.</li>
<li>Provides a template for constructing larger and more sophisticated models.</li>
</ol>
<p>The reason CIFAR-10 was selected was that it is complex enough to exercise
much of TensorFlow's ability to scale to large models. At the same time,
the model is small enough to train fast, which is ideal for trying out
new ideas and experimenting with new techniques.</p>
<h3 id="highlights_of_the_tutorial">Highlights of the Tutorial</h3>
<p>The CIFAR-10 tutorial demonstrates several important constructs for
designing larger and more sophisticated models in TensorFlow:</p>
<ul>
<li>Core mathematical components including <a href="../api_docs/python/tf/nn/conv2d">convolution</a>
(<a href="https://en.wikipedia.org/wiki/Convolution">wiki</a>),
<a href="../api_docs/python/tf/nn/relu">rectified linear activations</a>
(<a href="https://en.wikipedia.org/wiki/Rectifier_(neural_networks)">wiki</a>),
<a href="../api_docs/python/tf/nn/max_pool">max pooling</a>
(<a href="https://en.wikipedia.org/wiki/Convolutional_neural_network#Pooling_layer">wiki</a>)
and <a href="../api_docs/python/tf/nn/local_response_normalization">local response normalization</a>
(Chapter 3.3 in
<a href="https://papers.nips.cc/paper/4824-imagenet-classification-with-deep-convolutional-neural-networks.pdf">AlexNet paper</a>).</li>
<li><a href="../get_started/summaries_and_tensorboard">Visualization</a>
of network activities during training, including input images,
losses and distributions of activations and gradients.</li>
<li>Routines for calculating the
<a href="../api_docs/python/tf/train/ExponentialMovingAverage">moving average</a>
of learned parameters and using these averages
during evaluation to boost predictive performance.</li>
<li>Implementation of a
<a href="../api_docs/python/tf/train/exponential_decay">learning rate schedule</a>
that systematically decrements over time.</li>
<li>Prefetching <a href="../api_docs/python/tf/train/shuffle_batch">queues</a>
for input
data to isolate the model from disk latency and expensive image pre-processing.</li>
</ul>
<p>We also provide a <a href="deep_cnn#training_a_model_using_multiple_gpu_cards">multi-GPU version</a>
of the model which demonstrates:</p>
<ul>
<li>Configuring a model to train across multiple GPU cards in parallel.</li>
<li>Sharing and updating variables among multiple GPUs.</li>
</ul>
<p>We hope that this tutorial provides a launch point for building larger CNNs for
vision tasks on TensorFlow.</p>
<h3 id="model_architecture">Model Architecture</h3>
<p>The model in this CIFAR-10 tutorial is a multi-layer architecture consisting of
alternating convolutions and nonlinearities. These layers are followed by fully
connected layers leading into a softmax classifier.  The model follows the
architecture described by
<a href="https://code.google.com/p/cuda-convnet/">Alex Krizhevsky</a>, with a few
differences in the top few layers.</p>
<p>This model achieves a peak performance of about 86% accuracy within a few hours
of training time on a GPU. Please see <a href="deep_cnn#evaluating_a_model">below</a> and the code
for details.  It consists of 1,068,298 learnable parameters and requires about
19.5M multiply-add operations to compute inference on a single image.</p>
<h2 id="code_organization">Code Organization</h2>
<p>The code for this tutorial resides in
<a href="../code/tensorflow_models/tutorials/image/cifar10/index.html"><code>models/tutorials/image/cifar10/</code></a>.</p>
<table>
<thead>
<tr>
<th>File</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="../code/tensorflow_models/tutorials/image/cifar10/cifar10_input.py"><code>cifar10_input.py</code></a></td>
<td>Reads the native CIFAR-10 binary file format.</td>
</tr>
<tr>
<td><a href="../code/tensorflow_models/tutorials/image/cifar10/cifar10.py"><code>cifar10.py</code></a></td>
<td>Builds the CIFAR-10 model.</td>
</tr>
<tr>
<td><a href="../code/tensorflow_models/tutorials/image/cifar10/cifar10_train.py"><code>cifar10_train.py</code></a></td>
<td>Trains a CIFAR-10 model on a CPU or GPU.</td>
</tr>
<tr>
<td><a href="../code/tensorflow_models/tutorials/image/cifar10/cifar10_multi_gpu_train.py"><code>cifar10_multi_gpu_train.py</code></a></td>
<td>Trains a CIFAR-10 model on multiple GPUs.</td>
</tr>
<tr>
<td><a href="../code/tensorflow_models/tutorials/image/cifar10/cifar10_eval.py"><code>cifar10_eval.py</code></a></td>
<td>Evaluates the predictive performance of a CIFAR-10 model.</td>
</tr>
</tbody>
</table>
<h2 id="cifar-10_model">CIFAR-10 Model</h2>
<p>The CIFAR-10 network is largely contained in
<a href="../code/tensorflow_models/tutorials/image/cifar10/cifar10.py"><code>cifar10.py</code></a>.
The complete training
graph contains roughly 765 operations. We find that we can make the code most
reusable by constructing the graph with the following modules:</p>
<ol>
<li><a href="deep_cnn#model_inputs"><strong>Model inputs:</strong></a> <code>inputs()</code> and <code>distorted_inputs()</code> add
operations that read and preprocess CIFAR images for evaluation and training,
respectively.</li>
<li><a href="deep_cnn#model_prediction"><strong>Model prediction:</strong></a> <code>inference()</code>
adds operations that perform inference, i.e. classification, on supplied images.</li>
<li><a href="deep_cnn#model_training"><strong>Model training:</strong></a> <code>loss()</code> and <code>train()</code>
add operations that compute the loss,
gradients, variable updates and visualization summaries.</li>
</ol>
<h3 id="model_inputs">Model Inputs</h3>
<p>The input part of the model is built by the functions <code>inputs()</code> and
<code>distorted_inputs()</code> which read images from the CIFAR-10 binary data files.
These files contain fixed byte length records, so we use
<a href="../api_docs/python/tf/FixedLengthRecordReader"><code>tf.FixedLengthRecordReader</code></a>.
See <a href="../api_guides/python/reading_data#reading-from-files">Reading Data</a> to
learn more about how the <code>Reader</code> class works.</p>
<p>The images are processed as follows:</p>
<ul>
<li>They are cropped to 24 x 24 pixels, centrally for evaluation or
   <a href="../api_docs/python/tf/random_crop">randomly</a> for training.</li>
<li>They are <a href="../api_docs/python/tf/image/per_image_standardization">approximately whitened</a>
   to make the model insensitive to dynamic range.</li>
</ul>
<p>For training, we additionally apply a series of random distortions to
artificially increase the data set size:</p>
<ul>
<li><a href="../api_docs/python/tf/image/random_flip_left_right">Randomly flip</a> the image from left to right.</li>
<li>Randomly distort the <a href="../api_docs/python/tf/image/random_brightness">image brightness</a>.</li>
<li>Randomly distort the <a href="../api_docs/python/tf/image/random_contrast">image contrast</a>.</li>
</ul>
<p>Please see the <a href="../api_guides/python/image">Images</a> page for the list of
available distortions. We also attach an
<a href="../api_docs/python/tf/summary/image"><code>tf.summary.image</code></a> to the images
so that we may visualize them in <a href="../get_started/summaries_and_tensorboard">TensorBoard</a>.
This is a good practice to verify that inputs are built correctly.</p>
<div style="width:50%; margin:auto; margin-bottom:10px; margin-top:20px;">
  <img style="width:70%" src="../images/cifar_image_summary.png">
</div>

<p>Reading images from disk and distorting them can use a non-trivial amount of
processing time. To prevent these operations from slowing down training, we run
them inside 16 separate threads which continuously fill a TensorFlow
<a href="../api_docs/python/tf/train/shuffle_batch">queue</a>.</p>
<h3 id="model_prediction">Model Prediction</h3>
<p>The prediction part of the model is constructed by the <code>inference()</code> function
which adds operations to compute the <em>logits</em> of the predictions. That part of
the model is organized as follows:</p>
<table>
<thead>
<tr>
<th>Layer Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>conv1</code></td>
<td><a href="../api_docs/python/tf/nn/conv2d">convolution</a> and <a href="../api_docs/python/tf/nn/relu">rectified linear</a> activation.</td>
</tr>
<tr>
<td><code>pool1</code></td>
<td><a href="../api_docs/python/tf/nn/max_pool">max pooling</a>.</td>
</tr>
<tr>
<td><code>norm1</code></td>
<td><a href="../api_docs/python/tf/nn/local_response_normalization">local response normalization</a>.</td>
</tr>
<tr>
<td><code>conv2</code></td>
<td><a href="../api_docs/python/tf/nn/conv2d">convolution</a> and <a href="../api_docs/python/tf/nn/relu">rectified linear</a> activation.</td>
</tr>
<tr>
<td><code>norm2</code></td>
<td><a href="../api_docs/python/tf/nn/local_response_normalization">local response normalization</a>.</td>
</tr>
<tr>
<td><code>pool2</code></td>
<td><a href="../api_docs/python/tf/nn/max_pool">max pooling</a>.</td>
</tr>
<tr>
<td><code>local3</code></td>
<td><a href="../api_guides/python/nn">fully connected layer with rectified linear activation</a>.</td>
</tr>
<tr>
<td><code>local4</code></td>
<td><a href="../api_guides/python/nn">fully connected layer with rectified linear activation</a>.</td>
</tr>
<tr>
<td><code>softmax_linear</code></td>
<td>linear transformation to produce logits.</td>
</tr>
</tbody>
</table>
<p>Here is a graph generated from TensorBoard describing the inference operation:</p>
<div style="width:15%; margin:auto; margin-bottom:10px; margin-top:20px;">
  <img style="width:100%" src="../images/cifar_graph.png">
</div>

<blockquote>
<p><strong>EXERCISE</strong>: The output of <code>inference</code> are un-normalized logits. Try editing
the network architecture to return normalized predictions using
<a href="../api_docs/python/tf/nn/softmax"><code>tf.nn.softmax</code></a>.</p>
</blockquote>
<p>The <code>inputs()</code> and <code>inference()</code> functions provide all the components
necessary to perform an evaluation of a model. We now shift our focus towards
building operations for training a model.</p>
<blockquote>
<p><strong>EXERCISE:</strong> The model architecture in <code>inference()</code> differs slightly from
the CIFAR-10 model specified in
<a href="https://code.google.com/p/cuda-convnet/">cuda-convnet</a>.  In particular, the top
layers of Alex's original model are locally connected and not fully connected.
Try editing the architecture to exactly reproduce the locally connected
architecture in the top layer.</p>
</blockquote>
<h3 id="model_training">Model Training</h3>
<p>The usual method for training a network to perform N-way classification is
<a href="https://en.wikipedia.org/wiki/Multinomial_logistic_regression">multinomial logistic regression</a>,
aka. <em>softmax regression</em>. Softmax regression applies a
<a href="../api_docs/python/tf/nn/softmax">softmax</a> nonlinearity to the
output of the network and calculates the
<a href="../api_docs/python/tf/nn/sparse_softmax_cross_entropy_with_logits">cross-entropy</a>
between the normalized predictions and the label index.
For regularization, we also apply the usual
<a href="../api_docs/python/tf/nn/l2_loss">weight decay</a> losses to all learned
variables.  The objective function for the model is the sum of the cross entropy
loss and all these weight decay terms, as returned by the <code>loss()</code> function.</p>
<p>We visualize it in TensorBoard with a <a href="../api_docs/python/tf/summary/scalar"><code>tf.summary.scalar</code></a>:</p>
<p><img alt="CIFAR-10 Loss" src="../images/cifar_loss.png" title="CIFAR-10 Total Loss" /></p>
<p>We train the model using standard
<a href="https://en.wikipedia.org/wiki/Gradient_descent">gradient descent</a>
algorithm (see <a href="../api_guides/python/train">Training</a> for other methods)
with a learning rate that
<a href="../api_docs/python/tf/train/exponential_decay">exponentially decays</a>
over time.</p>
<p><img alt="CIFAR-10 Learning Rate Decay" src="../images/cifar_lr_decay.png" title="CIFAR-10 Learning Rate Decay" /></p>
<p>The <code>train()</code> function adds the operations needed to minimize the objective by
calculating the gradient and updating the learned variables (see
<a href="../api_docs/python/tf/train/GradientDescentOptimizer"><code>tf.train.GradientDescentOptimizer</code></a>
for details).  It returns an operation that executes all the calculations
needed to train and update the model for one batch of images.</p>
<h2 id="launching_and_training_the_model">Launching and Training the Model</h2>
<p>We have built the model, let's now launch it and run the training operation with
the script <code>cifar10_train.py</code>.</p>
<pre class="prettyprint lang-shell"><code>python cifar10_train.py
</code></pre>

<blockquote>
<p><strong>NOTE:</strong> The first time you run any target in the CIFAR-10 tutorial,
the CIFAR-10 dataset is automatically downloaded. The data set is ~160MB
so you may want to grab a quick cup of coffee for your first run.</p>
</blockquote>
<p>You should see the output:</p>
<pre class="prettyprint lang-shell"><code>Filling queue with 20000 CIFAR images before starting to train. This will take a few minutes.
2015-11-04 11:45:45.927302: step 0, loss = 4.68 (2.0 examples/sec; 64.221 sec/batch)
2015-11-04 11:45:49.133065: step 10, loss = 4.66 (533.8 examples/sec; 0.240 sec/batch)
2015-11-04 11:45:51.397710: step 20, loss = 4.64 (597.4 examples/sec; 0.214 sec/batch)
2015-11-04 11:45:54.446850: step 30, loss = 4.62 (391.0 examples/sec; 0.327 sec/batch)
2015-11-04 11:45:57.152676: step 40, loss = 4.61 (430.2 examples/sec; 0.298 sec/batch)
2015-11-04 11:46:00.437717: step 50, loss = 4.59 (406.4 examples/sec; 0.315 sec/batch)
...
</code></pre>

<p>The script reports the total loss every 10 steps as well as the speed at which
the last batch of data was processed. A few comments:</p>
<ul>
<li>
<p>The first batch of data can be inordinately slow (e.g. several minutes) as the
preprocessing threads fill up the shuffling queue with 20,000 processed CIFAR
images.</p>
</li>
<li>
<p>The reported loss is the average loss of the most recent batch. Remember that
this loss is the sum of the cross entropy and all weight decay terms.</p>
</li>
<li>
<p>Keep an eye on the processing speed of a batch. The numbers shown above were
obtained on a Tesla K40c. If you are running on a CPU, expect slower performance.</p>
</li>
</ul>
<blockquote>
<p><strong>EXERCISE:</strong> When experimenting, it is sometimes annoying that the first
training step can take so long. Try decreasing the number of images that
initially fill up the queue.  Search for <code>min_fraction_of_examples_in_queue</code>
in <code>cifar10_input.py</code>.</p>
</blockquote>
<p><code>cifar10_train.py</code> periodically <a href="../api_docs/python/tf/train/Saver">saves</a>
all model parameters in
<a href="../programmers_guide/variables#saving-and-restoring">checkpoint files</a>
but it does <em>not</em> evaluate the model. The checkpoint file
will be used by <code>cifar10_eval.py</code> to measure the predictive
performance (see <a href="deep_cnn#evaluating_a_model">Evaluating a Model</a> below).</p>
<p>If you followed the previous steps, then you have now started training
a CIFAR-10 model. <a href="https://www.youtube.com/watch?v=9bZkp7q19f0">Congratulations!</a></p>
<p>The terminal text returned from <code>cifar10_train.py</code> provides minimal insight into
how the model is training. We want more insight into the model during training:</p>
<ul>
<li>Is the loss <em>really</em> decreasing or is that just noise?</li>
<li>Is the model being provided appropriate images?</li>
<li>Are the gradients, activations and weights reasonable?</li>
<li>What is the learning rate currently at?</li>
</ul>
<p><a href="../get_started/summaries_and_tensorboard">TensorBoard</a> provides this
functionality, displaying data exported periodically from <code>cifar10_train.py</code> via
a
<a href="../api_docs/python/tf/summary/FileWriter"><code>tf.summary.FileWriter</code></a>.</p>
<p>For instance, we can watch how the distribution of activations and degree of
sparsity in <code>local3</code> features evolve during training:</p>
<div style="width:100%; margin:auto; margin-bottom:10px; margin-top:20px; display: flex; flex-direction: row">
  <img style="flex-grow:1; flex-shrink:1;" src="../images/cifar_sparsity.png">
  <img style="flex-grow:1; flex-shrink:1;" src="../images/cifar_activations.png">
</div>

<p>Individual loss functions, as well as the total loss, are particularly
interesting to track over time. However, the loss exhibits a considerable amount
of noise due to the small batch size employed by training.  In practice we find
it extremely useful to visualize their moving averages in addition to their raw
values.  See how the scripts use
<a href="../api_docs/python/tf/train/ExponentialMovingAverage"><code>tf.train.ExponentialMovingAverage</code></a>
for this purpose.</p>
<h2 id="evaluating_a_model">Evaluating a Model</h2>
<p>Let us now evaluate how well the trained model performs on a hold-out data set.
The model is evaluated by the script <code>cifar10_eval.py</code>.  It constructs the model
with the <code>inference()</code> function and uses all 10,000 images in the evaluation set
of CIFAR-10. It calculates the <em>precision at 1:</em> how often the top prediction
matches the true label of the image.</p>
<p>To monitor how the model improves during training, the evaluation script runs
periodically on the latest checkpoint files created by the <code>cifar10_train.py</code>.</p>
<pre class="prettyprint lang-shell"><code>python cifar10_eval.py
</code></pre>

<blockquote>
<p>Be careful not to run the evaluation and training binary on the same GPU or
else you might run out of memory. Consider running the evaluation on
a separate GPU if available or suspending the training binary while running
the evaluation on the same GPU.</p>
</blockquote>
<p>You should see the output:</p>
<pre class="prettyprint lang-shell"><code>2015-11-06 08:30:44.391206: precision @ 1 = 0.860
...
</code></pre>

<p>The script merely returns the precision @ 1 periodically -- in this case
it returned 86% accuracy. <code>cifar10_eval.py</code> also
exports summaries that may be visualized in TensorBoard. These summaries
provide additional insight into the model during evaluation.</p>
<p>The training script calculates the
<a href="../api_docs/python/tf/train/ExponentialMovingAverage">moving average</a>
version of all learned variables. The evaluation script substitutes
all learned model parameters with the moving average version. This
substitution boosts model performance at evaluation time.</p>
<blockquote>
<p><strong>EXERCISE:</strong> Employing averaged parameters may boost predictive performance
by about 3% as measured by precision @ 1. Edit <code>cifar10_eval.py</code> to not employ
the averaged parameters for the model and verify that the predictive performance
drops.</p>
</blockquote>
<h2 id="training_a_model_using_multiple_gpu_cards">Training a Model Using Multiple GPU Cards</h2>
<p>Modern workstations may contain multiple GPUs for scientific computation.
TensorFlow can leverage this environment to run the training operation
concurrently across multiple cards.</p>
<p>Training a model in a parallel, distributed fashion requires
coordinating training processes. For what follows we term <em>model replica</em>
to be one copy of a model training on a subset of data.</p>
<p>Naively employing asynchronous updates of model parameters
leads to sub-optimal training performance
because an individual model replica might be trained on a stale
copy of the model parameters. Conversely, employing fully synchronous
updates will be as slow as the slowest model replica.</p>
<p>In a workstation with multiple GPU cards, each GPU will have similar speed
and contain enough memory to run an entire CIFAR-10 model. Thus, we opt to
design our training system in the following manner:</p>
<ul>
<li>Place an individual model replica on each GPU.</li>
<li>Update model parameters synchronously by waiting for all GPUs to finish
processing a batch of data.</li>
</ul>
<p>Here is a diagram of this model:</p>
<div style="width:40%; margin:auto; margin-bottom:10px; margin-top:20px;">
  <img style="width:100%" src="../images/Parallelism.png">
</div>

<p>Note that each GPU computes inference as well as the gradients for a unique
batch of data. This setup effectively permits dividing up a larger batch
of data across the GPUs.</p>
<p>This setup requires that all GPUs share the model parameters. A well-known
fact is that transferring data to and from GPUs is quite slow. For this
reason, we decide to store and update all model parameters on the CPU (see
green box). A fresh set of model parameters is transferred to the GPU
when a new batch of data is processed by all GPUs.</p>
<p>The GPUs are synchronized in operation. All gradients are accumulated from
the GPUs and averaged (see green box). The model parameters are updated with
the gradients averaged across all model replicas.</p>
<h3 id="placing_variables_and_operations_on_devices">Placing Variables and Operations on Devices</h3>
<p>Placing operations and variables on devices requires some special
abstractions.</p>
<p>The first abstraction we require is a function for computing inference and
gradients for a single model replica. In the code we term this abstraction
a "tower". We must set two attributes for each tower:</p>
<ul>
<li>
<p>A unique name for all operations within a tower.
<a href="../api_docs/python/tf/name_scope"><code>tf.name_scope</code></a> provides
this unique name by prepending a scope. For instance, all operations in
the first tower are prepended with <code>tower_0</code>, e.g. <code>tower_0/conv1/Conv2D</code>.</p>
</li>
<li>
<p>A preferred hardware device to run the operation within a tower.
<a href="../api_docs/python/tf/device"><code>tf.device</code></a> specifies this. For
instance, all operations in the first tower reside within <code>device('/device:GPU:0')</code>
scope indicating that they should be run on the first GPU.</p>
</li>
</ul>
<p>All variables are pinned to the CPU and accessed via
<a href="../api_docs/python/tf/get_variable"><code>tf.get_variable</code></a>
in order to share them in a multi-GPU version.
See how-to on <a href="../programmers_guide/variables">Sharing Variables</a>.</p>
<h3 id="launching_and_training_the_model_on_multiple_gpu_cards">Launching and Training the Model on Multiple GPU cards</h3>
<p>If you have several GPU cards installed on your machine you can use them to
train the model faster with the <code>cifar10_multi_gpu_train.py</code> script.  This
version of the training script parallelizes the model across multiple GPU cards.</p>
<pre class="prettyprint lang-shell"><code>python cifar10_multi_gpu_train.py --num_gpus=2
</code></pre>

<p>Note that the number of GPU cards used defaults to 1. Additionally, if only 1
GPU is available on your machine, all computations will be placed on it, even if
you ask for more.</p>
<blockquote>
<p><strong>EXERCISE:</strong> The default settings for <code>cifar10_train.py</code> is to
run on a batch size of 128. Try running <code>cifar10_multi_gpu_train.py</code> on 2 GPUs
with a batch size of 64 and compare the training speed.</p>
</blockquote>
<h2 id="next_steps">Next Steps</h2>
<p><a href="https://www.youtube.com/watch?v=9bZkp7q19f0">Congratulations!</a> You have
completed the CIFAR-10 tutorial.</p>
<p>If you are now interested in developing and training your own image
classification system, we recommend forking this tutorial and replacing
components to address your image classification problem.</p>
<blockquote>
<p><strong>EXERCISE:</strong> Download the
<a href="http://ufldl.stanford.edu/housenumbers/">Street View House Numbers (SVHN)</a> data set.
Fork the CIFAR-10 tutorial and swap in the SVHN as the input data. Try adapting
the network architecture to improve predictive performance.</p>
</blockquote>

  </div>
  

  
        
  







        
<div class="devsite-content-footer nocontent">
  
  
    <p>Except as otherwise noted, the content of this page is licensed under the <a href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0 License</a>, and code samples are licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 License</a>. For details, see our <a href="https://developers.google.cn/terms/site-policies">Site Policies</a>. Java is a registered trademark of Oracle and/or its affiliates.</p>
  

  
    
    <p class="devsite-content-footer-date" itemprop="datePublished"
       content="2018-01-27T01:30:38.136300">
      
      上次更新日期：一月 27, 2018
    </p>
  

</div>

        </article>
      </article>
  

        </div>
      

<footer class="devsite-footer-linkboxes nocontent
               devsite-footer-linkboxes-all-backup
               "><nav class="devsite-full-site-width"><ul class="devsite-footer-linkboxes-list"><li class="devsite-footer-linkbox devsite-footer-linkbox-backup"><h3 class="devsite-footer-linkbox-heading">把握动态</h3><ul class="devsite-footer-linkbox-list"><li class="devsite-footer-linkbox-item"><a href="https://research.googleblog.com/search/label/TensorFlow" class="gc-analytics-event"
               data-category="Site-Wide Custom Events"
               data-label="Footer Blog Link">
                博客
            </a></li><li class="devsite-footer-linkbox-item"><a href="https://github.com/tensorflow/" class="gc-analytics-event"
               data-category="Site-Wide Custom Events"
               data-label="Footer GitHub Link">
                GitHub
            </a></li><li class="devsite-footer-linkbox-item"><a href="https://twitter.com/tensorflow" class="gc-analytics-event"
               data-category="Site-Wide Custom Events"
               data-label="Footer Twitter Link">
                Twitter
            </a></li></ul></li><li class="devsite-footer-linkbox devsite-footer-linkbox-backup"><h3 class="devsite-footer-linkbox-heading">支持</h3><ul class="devsite-footer-linkbox-list"><li class="devsite-footer-linkbox-item"><a href="https://github.com/tensorflow/tensorflow/issues" class="gc-analytics-event"
               data-category="Site-Wide Custom Events"
               data-label="Footer Issue Tracker Link">
                问题跟踪器
            </a></li><li class="devsite-footer-linkbox-item"><a href="https://github.com/tensorflow/tensorflow/blob/master/RELEASE.md" class="gc-analytics-event"
               data-category="Site-Wide Custom Events"
               data-label="Footer Release Notes Link">
                版本说明
            </a></li><li class="devsite-footer-linkbox-item"><a href="https://stackoverflow.com/questions/tagged/tensorflow" class="gc-analytics-event"
               data-category="Site-Wide Custom Events"
               data-label="Footer Stack Overflow Link">
                Stack Overflow
            </a></li></ul></li></ul></nav></footer><footer class="devsite-utility-footer"><nav class="devsite-utility-footer-nav devsite-nav devsite-full-site-width"><div class="devsite-utility-footer-nav-left"><form class="devsite-utility-footer-language" action="https://tensorflow.google.cn/i18n/setlang/" method="post"><input type="hidden" name="xsrf_token" value="v_q5Wb0wb8fFAh5_LkcHiN8SCwQe7Bxhi_VmvxKNP_Q6MTUxNzg3MjYzNDU5NTM2MA" /><input type="hidden" name="next" value="/tutorials/deep_cnn"><select class="devsite-utility-footer-language-select kd-select" name="language"
                track-type="languageSelector" track-name="click"><option value="en"
                
                track-type="languageSelector" track-name="changed"
                track-metadata-original-language="zh-cn"
                track-metadata-selected-language="en">
            English
          </option><option value="zh-cn"
                 selected="selected" 
                track-type="languageSelector" track-name="changed"
                track-metadata-original-language="zh-cn"
                track-metadata-selected-language="zh-cn">
            简体中文
          </option></select></form><span class="devsite-utility-footer-links"><a class="devsite-utility-footer-link gc-analytics-event"
           href="http://www.google.cn/policies/terms/"
           data-category="Site-Wide Custom Events"
           data-label="Footer terms link"
           data-footer-link-id="terms"
           >条款
         </a><a class="devsite-utility-footer-link gc-analytics-event"
           href="http://www.google.cn/policies/privacy/"
           data-category="Site-Wide Custom Events"
           data-label="Footer privacy link"
           data-footer-link-id="privacy"
           
           data-cookie-policy="//www.google.cn/policies/technologies/cookies/"
           >隐私权
         </a></span></div></nav></footer></div><script async defer src="https://www.gstatic.com/feedback/api.js"></script><script src="../_static2/18908e5f48/jsi18n/index.html"></script><script src="../_static/18908e5f48/js/script_foot_closure__zh_cn.js"></script><script src="../_static/18908e5f48/js/script_foot.js"></script><script>
        (function($) {
          
          devsite.devsite.Init($, {'FULL_SITE_SEARCH_ENABLED': 0, 'ENABLE_BLOCKED_VIDEO_PLACEHOLDER': 1, 'VERSION_HASH': '18908e5f48', 'SITE_NAME': 'tensorflow_china', 'HISTORY_ENABLED': 0, 'ENABLE_BLOCKED_LINK_TOOLTIP': 1, 'ALLOWED_HOSTS': ['.android.com', '.anvato.com', '.apigee.com', '.appspot.com', '.dialogflow.com', '.gonglchuangl.net', '.google.cn', '.google.com', '.googleplex.com', '.nest.com', '.openthread.io', '.openweave.io', '.orbitera.com', '.tensorflow.org'], 'BLOCK_RSS_FEEDS': 1, 'SCRIPTSAFE_DOMAIN': 'tensorflow-dot-google-developers.gonglchuangl.net'},
                               '[]','zh-cn',
                               true, '',
                               {"f62218c009ec029abef196bba5aa34cf": true, "098dafe57affddc137df300142652cfd": false, "8e03e230de0bd8a6fe173fdf172e8b3f": true, "cb025a64a50094835616312f4774a53d": true, "51470233c56fc1fde50f00b73c52b216": false, "d169d485cf24243a263783dbe42029b1": true, "039e5d84b87fd75807ffb37b7f1bbf2c": true, "752953480de00a336d911a46966cc16d": false, "700def1a83e356c06c0925afb05de4b0": false, "6749dcb526ce9bde6993550c7d928d24": true}, '/',
                               'https://tensorflow.google.cn/');
        })(jQuery);

        
        devsite.localInit = function() {
          
        };

      </script><script>
      $('.devsite-utility-footer-language-select').each(function() {
        $(this).change(function(){$('.devsite-utility-footer-language').submit();});
      });
      </script></div><span id="devsite-request-elapsed" data-request-elapsed="485.509872437"></span></body></html>
